<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pymgpipe.main &mdash; pymgpipe v0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=34cd777e"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pymgpipe
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pymgpipe.html">pymgpipe package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pymgpipe</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pymgpipe.main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pymgpipe.main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">skbio</span> 
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="kn">from</span> <span class="nn">cobra</span> <span class="kn">import</span> <span class="n">Configuration</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">squareform</span><span class="p">,</span> <span class="n">pdist</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">.modeling</span> <span class="kn">import</span> <span class="n">build</span>
<span class="kn">from</span> <span class="nn">.diet</span> <span class="kn">import</span> <span class="n">add_diet_to_model</span>
<span class="kn">from</span> <span class="nn">.io</span> <span class="kn">import</span> <span class="n">load_cobra_model</span><span class="p">,</span> <span class="n">write_lp_problem</span><span class="p">,</span> <span class="n">write_cobra_model</span><span class="p">,</span> <span class="n">suppress_stdout</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">load_dataframe</span><span class="p">,</span> <span class="n">remove_reverse_vars</span>
<span class="kn">from</span> <span class="nn">.coupling</span> <span class="kn">import</span> <span class="n">add_coupling_constraints</span>
<span class="kn">from</span> <span class="nn">.metrics</span> <span class="kn">import</span> <span class="n">_compute_diversity_metrics</span>
<span class="kn">from</span> <span class="nn">.logger</span> <span class="kn">import</span> <span class="n">logger</span>

<span class="n">cobra_config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="p">()</span>
<span class="n">cobra_config</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
<span class="n">cobra_config</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">1000</span>


<div class="viewcode-block" id="build_models">
<a class="viewcode-back" href="../../pymgpipe.html#pymgpipe.main.build_models">[docs]</a>
<span class="k">def</span> <span class="nf">build_models</span><span class="p">(</span>
    <span class="n">coverage_file</span><span class="p">,</span>
    <span class="n">taxa_dir</span><span class="p">,</span>
    <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;gurobi&quot;</span><span class="p">,</span>
    <span class="n">threads</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
    <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lp_type</span><span class="o">=</span><span class="s2">&quot;.mps&quot;</span><span class="p">,</span>
    <span class="n">cobra_type</span><span class="o">=</span><span class="s2">&quot;.xml&quot;</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">coupling_constraints</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">diet_fecal_compartments</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">remove_reverse_vars_from_lp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">hard_remove</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">abundance_threshold</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="n">diet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vaginal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">essential_metabolites</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="n">micronutrients</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">force_uptake</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">diet_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">compute_metrics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">sample_prefix</span><span class="o">=</span><span class="s1">&#39;mc&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build community COBRA models using mgpipe-like compartments and constraints.</span>

<span class="sd">    This function is pymgpipe&#39;s main model building function, and can be used to build models for either one or multiple samples.</span>

<span class="sd">    Args:</span>
<span class="sd">        coverage_file (pandas.DataFrame | str): Abundance matrix with taxa as rows and samples as columns</span>
<span class="sd">        taxa_dir (str): Directory containing individual strain/species taxa models (file names corresponding to index of coverage matrix)</span>
<span class="sd">        out_dir (str): Directory to save output of this function (models, LP problems, etc.), defaults to cwd</span>
<span class="sd">        diet_fecal_compartments (bool): Build models with mgpipe&#39;s diet/fecal compartmentalization, defaults to False</span>
<span class="sd">        coupling_constraints (bool): Add mgpipe&#39;s abundance coupling constraints to internal reactions, defaults to True</span>
<span class="sd">        remove_reverse_vars_from_lp (bool): Remove reverse variables that are added into COBRApy models</span>
<span class="sd">        hard_remove (bool): If set to True, variables will be removed entirely from models, which can be a time consuming process. Having it set to False will `remove` them by setting their bounds to 0.</span>
<span class="sd">        diet (str): Name of diet or file you want to impose on models (can be one diet or personalized)</span>
<span class="sd">        vaginal (bool): Impose vaginal diet constraints to support vaginal diet</span>
<span class="sd">        essential_metabolites (list): List of metabolites to include as essential within the diet</span>
<span class="sd">        micronutrients (list): List of metabolites to include as micronutrients within diet</span>
<span class="sd">        force_uptake (bool): Force minimum uptake of nutrients from diet</span>
<span class="sd">        diet_threshold (float): Threshold on imposed diet uptake, i.e. lb &lt; metabolite &lt; (threshold * lb)</span>
<span class="sd">        solver (str): LP solver (gurobi or cplex) used to solve models, defaults to gurobi</span>
<span class="sd">        parallel (bool): Samples will be built in parallel if set to True</span>
<span class="sd">        threads (int): Number of threads to use if building in parallel</span>
<span class="sd">        lp_type (str): File type for LP problem (either .mps or .lp), defaults to .mps</span>
<span class="sd">        cobra_type (str): File type for COBRA model (.xml, .mat, .json), defaults to .xml</span>
<span class="sd">        compress (bool): Models and LP problems will be saved as compressed files if set to True, defaults to True</span>
<span class="sd">        compute_metrics (bool): Compute diversity metrics for built models, defaults to True</span>

<span class="sd">    Notes:</span>
<span class="sd">        COBRA models written to *out_dir/models/*\n</span>
<span class="sd">        LP problems written to *out_dir/problems/*\n</span>
<span class="sd">        All modifications done at the level of the LP (i.e. coupling constraints, diet) are not saved when writing COBRA models to file. For this reason, it is always recommended to work with LP models in the `problems/` folder.</span>

<span class="sd">    &quot;&quot;&quot;</span>
     
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">cobra_config</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="n">solver</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">taxa_dir</span> <span class="o">=</span> <span class="n">taxa_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="k">if</span> <span class="n">taxa_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span> <span class="k">else</span> <span class="n">taxa_dir</span>
    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="k">if</span> <span class="n">out_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span> <span class="k">else</span> <span class="n">out_dir</span>

    <span class="n">model_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;models/&quot;</span>
    <span class="n">problem_dir</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;problems/&quot;</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Path</span><span class="p">(</span><span class="n">problem_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">formatted</span> <span class="o">=</span> <span class="n">_format_coverage_file</span><span class="p">(</span><span class="n">coverage_file</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">sample_prefix</span><span class="p">)</span>
    <span class="n">samples_to_run</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">formatted</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">taxa</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">formatted</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Found coverage file with </span><span class="si">%s</span><span class="s2"> samples and </span><span class="si">%s</span><span class="s2"> unique taxa&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_to_run</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxa</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">samples_to_run</span> <span class="o">=</span> <span class="n">samples</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">samples</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_to_run</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">parallel</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">threads</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">threads</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">threads</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">threads</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_to_run</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Building </span><span class="si">%s</span><span class="s2"> models...&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples_to_run</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----------------Parameters----------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Diet/fecal compartments- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">diet_fecal_compartments</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coupling constraints- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">coupling_constraints</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parallel- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Threads- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">threads</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solver- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">solver</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LP type- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">lp_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;COBRA type- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">cobra_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compress- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">compress</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Output directory- </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="n">_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">_inner</span><span class="p">,</span>
        <span class="n">formatted</span><span class="p">,</span>
        <span class="n">taxa_dir</span><span class="p">,</span>
        <span class="n">solver</span><span class="p">,</span>
        <span class="n">model_dir</span><span class="p">,</span>
        <span class="n">problem_dir</span><span class="p">,</span>
        <span class="n">lp_type</span><span class="p">,</span>
        <span class="n">cobra_type</span><span class="p">,</span>
        <span class="n">coupling_constraints</span><span class="p">,</span>
        <span class="n">diet_fecal_compartments</span><span class="p">,</span>
        <span class="n">remove_reverse_vars_from_lp</span><span class="p">,</span>
        <span class="n">hard_remove</span><span class="p">,</span>
        <span class="n">diet</span><span class="p">,</span>
        <span class="n">vaginal</span><span class="p">,</span>
        <span class="n">essential_metabolites</span><span class="p">,</span>
        <span class="n">micronutrients</span><span class="p">,</span>
        <span class="n">force_uptake</span><span class="p">,</span>
        <span class="n">diet_threshold</span><span class="p">,</span>
        <span class="n">abundance_threshold</span><span class="p">,</span>
        <span class="n">compress</span><span class="p">,</span>
        <span class="n">compute_metrics</span><span class="p">,</span>
        <span class="n">force</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">threads</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">_mute</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">samples_to_run</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_to_run</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_func</span><span class="p">,</span> <span class="n">samples_to_run</span><span class="p">)),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">samples_to_run</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">compute_metrics</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">abundance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]:</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;reaction_abundance&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">})</span>
            <span class="n">abundance_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">out_dir</span><span class="o">+</span><span class="s1">&#39;reaction_abundance.csv&#39;</span><span class="p">)</span>

            <span class="n">abundance_df</span><span class="p">[</span><span class="n">abundance_df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">abundance_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">out_dir</span><span class="o">+</span><span class="s1">&#39;reaction_content.csv&#39;</span><span class="p">)</span>

            <span class="n">unique_reactions</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;taxa&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;unique_reactions&#39;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">unique_reactions</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;# Taxa&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;# Unique Reactions&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">unique_reactions</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Metabolic Diversity&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_dir</span><span class="o">+</span><span class="s1">&#39;metabolic_diversity.png&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

            <span class="c1"># PCoA plot of reaction presence </span>
            <span class="n">abundance_df</span> <span class="o">=</span> <span class="n">abundance_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">pdist</span><span class="p">(</span><span class="n">abundance_df</span><span class="p">,</span> <span class="s1">&#39;braycurtis&#39;</span><span class="p">))</span>
            <span class="n">my_pcoa</span> <span class="o">=</span> <span class="n">skbio</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ordination</span><span class="o">.</span><span class="n">pcoa</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span>

            <span class="n">pcoa_points</span> <span class="o">=</span> <span class="n">my_pcoa</span><span class="o">.</span><span class="n">samples</span>
            <span class="n">pcoa_points</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">abundance_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pcoa_points</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;PC1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;PC2&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">pcoa_points</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
            <span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;PC1 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">my_pcoa</span><span class="o">.</span><span class="n">proportion_explained</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f explained variance&#39;</span>
            <span class="n">str2</span> <span class="o">=</span> <span class="s1">&#39;PC2 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">my_pcoa</span><span class="o">.</span><span class="n">proportion_explained</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f explained variance&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">str1</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">str2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;PCoA of reaction presence (braycurtis)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([],[],</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pcoa_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pcoa_points</span><span class="p">[</span><span class="s1">&#39;PC1&#39;</span><span class="p">][</span><span class="n">line</span><span class="p">]</span><span class="o">+</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">pcoa_points</span><span class="p">[</span><span class="s1">&#39;PC2&#39;</span><span class="p">][</span><span class="n">line</span><span class="p">]</span><span class="o">+</span><span class="mf">0.001</span><span class="p">,</span> 
                <span class="n">pcoa_points</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> 
                <span class="n">size</span><span class="o">=</span><span class="s1">&#39;small&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;light&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_dir</span><span class="o">+</span><span class="s1">&#39;reaction_pcoa.png&#39;</span><span class="p">)</span>


        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Ran into problem while saving metrics...skipping this step!</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>
            <span class="k">pass</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished building </span><span class="si">%s</span><span class="s2"> models and associated LP problems!&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Process took </span><span class="si">%s</span><span class="s1"> minutes to run...&#39;</span><span class="o">%</span><span class="nb">round</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span></div>



<span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span>
    <span class="n">coverage_df</span><span class="p">,</span>
    <span class="n">taxa_dir</span><span class="p">,</span>
    <span class="n">solver</span><span class="p">,</span>
    <span class="n">model_dir</span><span class="p">,</span>
    <span class="n">problem_dir</span><span class="p">,</span>
    <span class="n">lp_type</span><span class="p">,</span>
    <span class="n">cobra_type</span><span class="p">,</span>
    <span class="n">coupling_constraints</span><span class="p">,</span>
    <span class="n">diet_fecal_compartments</span><span class="p">,</span>
    <span class="n">remove_reverse_vars_from_lp</span><span class="p">,</span>
    <span class="n">hard_remove</span><span class="p">,</span>
    <span class="n">diet</span><span class="p">,</span>
    <span class="n">vaginal</span><span class="p">,</span>
    <span class="n">essential_metabolites</span><span class="p">,</span> 
    <span class="n">micronutrients</span><span class="p">,</span>
    <span class="n">force_uptake</span><span class="p">,</span>
    <span class="n">diet_threshold</span><span class="p">,</span>
    <span class="n">abundance_threshold</span><span class="p">,</span>
    <span class="n">compress</span><span class="p">,</span>
    <span class="n">compute_metrics</span><span class="p">,</span>
    <span class="n">force</span><span class="p">,</span>
    <span class="n">sample_label</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">model_out</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">model_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sample_label</span><span class="p">,</span> <span class="n">cobra_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">compress</span>
        <span class="k">else</span> <span class="n">model_dir</span> <span class="o">+</span> <span class="n">sample_label</span> <span class="o">+</span> <span class="s2">&quot;.xml.gz&quot;</span>
    <span class="p">)</span>
    <span class="n">lp_out</span> <span class="o">=</span> <span class="n">problem_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sample_label</span><span class="p">,</span> <span class="n">lp_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">pymgpipe_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_out</span><span class="p">):</span>
        <span class="n">pymgpipe_model</span> <span class="o">=</span> <span class="n">load_cobra_model</span><span class="p">(</span><span class="n">model_out</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">suppress_stdout</span><span class="p">():</span>
            <span class="n">pymgpipe_model</span> <span class="o">=</span> <span class="n">build</span><span class="p">(</span>
                <span class="n">sample</span><span class="o">=</span><span class="n">sample_label</span><span class="p">,</span>
                <span class="n">abundances</span><span class="o">=</span><span class="n">coverage_df</span><span class="p">,</span>
                <span class="n">taxa_directory</span><span class="o">=</span><span class="n">taxa_dir</span><span class="p">,</span>
                <span class="n">threshold</span><span class="o">=</span><span class="n">abundance_threshold</span><span class="p">,</span>
                <span class="n">diet_fecal_compartments</span><span class="o">=</span><span class="n">diet_fecal_compartments</span><span class="p">,</span>
                <span class="n">solver</span><span class="o">=</span><span class="n">solver</span>
            <span class="p">)</span>
        <span class="n">force</span> <span class="o">=</span> <span class="kc">True</span> 
        <span class="n">write_cobra_model</span><span class="p">(</span><span class="n">pymgpipe_model</span><span class="p">,</span> <span class="n">model_out</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">compute_metrics</span><span class="p">:</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">_compute_diversity_metrics</span><span class="p">(</span><span class="n">pymgpipe_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unable to compute diversity metrics for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">pymgpipe_model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">force</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lp_out</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lp_out</span><span class="o">+</span><span class="s1">&#39;.gz&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lp_out</span><span class="o">+</span><span class="s1">&#39;.7z&#39;</span><span class="p">)):</span>
        <span class="c1"># ----- START OPTLANG MODIFICATIONS -----</span>
        <span class="k">if</span> <span class="n">remove_reverse_vars_from_lp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Removing variables from </span><span class="si">%s</span><span class="s1">...&#39;</span><span class="o">%</span><span class="n">sample_label</span><span class="p">)</span>
                <span class="n">remove_reverse_vars</span><span class="p">(</span><span class="n">pymgpipe_model</span><span class="p">,</span><span class="n">hard_remove</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Failed to remove reverse variables!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">diet</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">add_diet_to_model</span><span class="p">(</span><span class="n">pymgpipe_model</span><span class="p">,</span> <span class="n">diet</span><span class="p">,</span> <span class="n">force_uptake</span><span class="p">,</span> <span class="n">essential_metabolites</span><span class="p">,</span> <span class="n">micronutrients</span><span class="p">,</span> <span class="n">vaginal</span><span class="p">,</span> <span class="n">diet_threshold</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">coupling_constraints</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Adding coupling constraints to </span><span class="si">%s</span><span class="s1">...&#39;</span><span class="o">%</span><span class="n">sample_label</span><span class="p">)</span>
                <span class="n">add_coupling_constraints</span><span class="p">(</span><span class="n">pymgpipe_model</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to add coupling constraints!&quot;</span><span class="p">)</span>

        <span class="n">write_lp_problem</span><span class="p">(</span><span class="n">pymgpipe_model</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="n">lp_out</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="n">compress</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Skipping </span><span class="si">%s</span><span class="s1"> because LP problem already exists!&#39;</span><span class="o">%</span><span class="n">sample_label</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">pymgpipe_model</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">metrics</span>


<span class="k">def</span> <span class="nf">_format_coverage_file</span><span class="p">(</span><span class="n">coverage_file</span><span class="p">,</span> <span class="n">out_dir</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">sample_prefix</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">coverage</span> <span class="o">=</span> <span class="n">load_dataframe</span><span class="p">(</span><span class="n">coverage_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sample_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">coverage</span>
    
    <span class="n">conversion_file_path</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">+</span> <span class="s2">&quot;sample_label_conversion.csv&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sample_conversion_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">conversion_file_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">sample_conversion_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">coverage</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Provided label conversion file </span><span class="si">%s</span><span class="s2"> does not provide labels for all samples!&quot;</span>
                <span class="o">%</span> <span class="n">conversion_file_path</span>
        <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sample_conversion_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">v</span><span class="p">:</span> <span class="n">sample_prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">coverage</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;conversion&quot;</span><span class="p">:</span> <span class="n">sample_conversion_dict</span><span class="p">})</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">conversion_file_path</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">coverage</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">sample_conversion_dict</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_mute</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Yoli Meydan, Federico Baldini, Tal Korem.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>