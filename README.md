## [pymgpipe](https://korem-lab.github.io/pymgpipe/) | [![Python package](https://github.com/korem-lab/pymgpipe/actions/workflows/python-package.yml/badge.svg?branch=main)](https://github.com/korem-lab/pymgpipe/actions/workflows/python-package.yml) [![Tests](https://github.com/korem-lab/pymgpipe/actions/workflows/tests.yml/badge.svg?branch=main)](https://github.com/korem-lab/pymgpipe/actions/workflows/tests.yml) [![Docs](https://github.com/korem-lab/pymgpipe/actions/workflows/docs.yml/badge.svg)](https://github.com/korem-lab/pymgpipe/actions/workflows/docs.yml)  
<!-- Pytest Coverage Comment:Begin -->
<a href="https://github.com/korem-lab/pymgpipe/blob/main/README.md"><img alt="Coverage" src="https://img.shields.io/badge/Coverage-76%25-yellow.svg" /></a><details><summary>Coverage Report </summary><table><tr><th>File</th><th>Stmts</th><th>Miss</th><th>Cover</th><th>Missing</th></tr><tbody><tr><td colspan="5"><b>pymgpipe</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/build.py">build.py</a></td><td>147</td><td>7</td><td>95%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/build.py#L27">27</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/build.py#L30">30</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/build.py#L45-L48">45&ndash;48</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/build.py#L119">119</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/build.py#L121">121</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/coupling.py">coupling.py</a></td><td>39</td><td>6</td><td>85%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/coupling.py#L20">20</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/coupling.py#L43">43</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/coupling.py#L46-L47">46&ndash;47</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/coupling.py#L52">52</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/coupling.py#L67">67</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py">diet.py</a></td><td>103</td><td>19</td><td>82%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L16">16</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L22">22</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L396-L397">396&ndash;397</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L437-L453">437&ndash;453</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L466-L477">466&ndash;477</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L482-L485">482&ndash;485</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L494">494</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L496">496</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/diet.py#L525">525</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py">fva.py</a></td><td>142</td><td>58</td><td>59%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L31">31</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L35">35</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L60-L63">60&ndash;63</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L70">70</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L79-L85">79&ndash;85</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L88-L89">88&ndash;89</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L92-L93">92&ndash;93</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L111-L121">111&ndash;121</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L137">137</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L146-L207">146&ndash;207</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/fva.py#L216">216</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py">io.py</a></td><td>106</td><td>36</td><td>66%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L17">17</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L55">55</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L61-L66">61&ndash;66</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L80-L81">80&ndash;81</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L95-L96">95&ndash;96</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L111">111</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L117-L120">117&ndash;120</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L125-L133">125&ndash;133</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L142">142</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L146-L147">146&ndash;147</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L152-L157">152&ndash;157</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L161-L167">161&ndash;167</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/io.py#L176-L177">176&ndash;177</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py">main.py</a></td><td>147</td><td>43</td><td>71%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L111">111</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L114">114</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L166">166</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L209-L211">209&ndash;211</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L242-L295">242&ndash;295</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L302">302</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L307-L308">307&ndash;308</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/main.py#L321">321</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/metrics.py">metrics.py</a></td><td>22</td><td>20</td><td>9%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/metrics.py#L4-L33">4&ndash;33</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/nmpc.py">nmpc.py</a></td><td>64</td><td>7</td><td>89%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/nmpc.py#L94">94</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/nmpc.py#L100-L101">100&ndash;101</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/nmpc.py#L140-L142">140&ndash;142</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/nmpc.py#L144">144</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py">utils.py</a></td><td>237</td><td>111</td><td>53%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L44-L45">44&ndash;45</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L48">48</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L51">51</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L66">66</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L72">72</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L82">82</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L86">86</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L101-L104">101&ndash;104</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L110">110</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L114-L116">114&ndash;116</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L119-L137">119&ndash;137</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L141-L147">141&ndash;147</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L155">155</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L189-L190">189&ndash;190</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L195-L197">195&ndash;197</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L235-L238">235&ndash;238</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L240-L254">240&ndash;254</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L260">260</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L271-L276">271&ndash;276</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L279-L283">279&ndash;283</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L303-L304">303&ndash;304</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L315-L357">315&ndash;357</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L360-L368">360&ndash;368</a>, <a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/utils.py#L374-L377">374&ndash;377</a></td></tr><tr><td colspan="5"><b>pymgpipe/tests</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/tests/test_e2e.py">test_e2e.py</a></td><td>90</td><td>1</td><td>99%</td><td><a href="https://github.com/korem-lab/pymgpipe/blob/main/pymgpipe/tests/test_e2e.py#L197">197</a></td></tr><tr><td><b>TOTAL</b></td><td><b>1299</b></td><td><b>308</b></td><td><b>76%</b></td><td>&nbsp;</td></tr></tbody></table></details>
<!-- Pytest Coverage Comment:End -->

### API Docs
https://korem-lab.github.io/pymgpipe/

### Installation
Run `pip install 'pymgpipe @ git+https://github.com/korem-lab/pymgpipe'`<br/><br/>
You should now just be able to `import pymgpipe`. If you get a **ModuleNotFoundError**, make sure you're using the same python environment you used with `pip`. I highly recommend using the `pyenv` package to manage python versions & environments.

### Additional Dependencies
Need at least one of the following solvers-

-  [cplex](<https://www-01.ibm.com/software/commerce/optimization/cplex-optimizer/>)
-  [gurobipy](<http://www.gurobi.com>)

If you're running python 3.8.*, you should be able to just use `pip install cplex` or `pip install gurobipy`. For later versions of python, this might not work. Also, this does not actually create a license, it just installs the python interface to interact with these solvers. Both gurobipy and cplex offer free academic licenses. 

### Inputs
To create multi-species community models with **pymgpipe**, you need two things to start-

-  Folder with individual taxa models (either in `.mat` or `.xml` format)
-  Relative abundance matrix (as a `.csv`) with samples as **columns** and taxa as **rows**. Taxa names should correspond to file names within taxa folder (excluding extension)

Examples of both can be found in the  `examples/` folder

### Outputs
The exact location and names of output files will vary depending on the parameters you pass into each function. However, the default output for pymgpipe's **build_models** function will look something like this-

```

* pymgpipe input*
.
├── taxaModels/
│   ├── taxa1.xml
│   ├── taxa2.xml
│   └── ...
├── abundances.csv

# pymgpipe output*
.
├── out/
    ├── reaction_content.csv
    ├── reaction_abundance.csv
    ├── sample_label_conversion.csv
    ├── metabolic_diversity.png
    ├── problems/
    │   ├── mc1.mps.gz
    │   ├── mc2.mps.gz
    │   └── ...
    └── models/
        ├── mc1.xml.gz
        ├── mc2.xml.gz
        └── ...
```

Here is a breakdown of each output files/directory and their descriptions-

| File | Type | Description |  
|---|---|---|
| reaction_content | CSV | Matrix showing binary presence/absence of all reactions within each sample | 
| reaction_abundance | CSV | Matrix showing scaled abundance (between 0 and 1) of all reactions within each sample  |  
| sample_label_conversion | CSV | Dictionary with conversion between original sample names and model names (default `sample_prefix` is 'mc') | 
| metabolic_diversity | PNG | Plot depicting # of unique reactions & taxa present within each sample | 
| problems | dir | Directory containing LP problems (default format is .mps, with `compressed` set to True) |  
| models | dir | Directory containing COBRA moddels (default format is .xml, with `compressed` set to True) | 

### Examples
Clone and run through `workflow.ipynb` in the **examples/** folder (see below)

### Creating a local copy (optional)
If you want to mess around with this code, clone repository into desired directory. Run `pip install .` from within directory, or `pip install path/to/directory` (if you've previously installed using github link above, you should run `pip uninstall pymgpipe` first to avoid conflicting versions). If you're having issues with dependencies, try running `pip install -r requirements.txt`

### Attribution

Please reference this
